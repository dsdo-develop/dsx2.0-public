### DS-X 2.0 API
---

1.  Авторизовать пользователя
```POST /login```

2. Напомнить пароль
```POST /remind-password```

3. Зарегистрировать пользователя
```POST /signup```

4. Получить информацию по строительным проектам (проект-проектная очередь - объект строительства)
```POST /users/projects```

5. Получить информацию по строительным работам для данного объекта строительства
```POST /users/object-works```

6. Получить список доступных корзин для данного подрядчика
```POST /users/baskets```

7. Добавить выбранные элементы для некоторой работы в корзину
```POST /users/add-to-basket```

8. Удалить все элементы по данной работе из корзины
```POST /users/delete-from-basket```

9. Отправить элементы в корзине по данной работе на проверку в технадзор
```POST /users/send-for-checking```

10. Закрыть активную корзину
```POST /users/close-basket```

11. Получить список карт (фильтров) для данного объекта строительства
```POST /users/object-maps```

12. Принять элементы по данной работе
```POST /users/accept-work```



---

#### 1. Авторизовать пользователя

```POST /login```

*Описание: метод служит для авторизации пользователя, возвращает JWT токен, который клиенту следует добавлять в заголовок каждого запроса.*

**request**:
 
```js
{
  user: "<STRING>",     // логин
  password: "<STRING>", // пароль
}
```

**response**:
 
```js
{
  status: 100,         // 100 - код успешного запроса
  response: {
    token: "<STRING>", // JWT токен
    role: "<ROLE>",    // роль пользователя 
    // ..., возможно что-то еще
  }
}
```

```
<ROLE> = "админ" | "технадзор" |"подрядчик"
```

**error response**:
 
```js
{
  status: 901,
  error: "Неверное имя пользователя или пароль"
}
```

---

#### 2. Напомнить пароль

```POST /remind-password```

*Метод отправляет пароль на email пользователя или на его мобильный телефон*

**request**:

```js
{
  user: "<STRING>"  // логин пользователя
}
```

**response**:

```js
{
  status: 100,
  response: {
    message: "Sent successfully",
  }
}
```

**error response**:
 
```js
{
  status: 902,
  error: "Пользователь не найден"
}
```

---

#### 3. Зарегистрировать пользователя

```POST /signup```

*Описание: метод регистрирует нового пользователя в системе.*
*Как осуществляется привязка к роли и инфраструктуре объетков пока неясно.*

**request**:

```js
{
  user: "<STRING>",   // логин
  fname: "<STRING>",  // имя
  lname: "<STRING>",  // фамилия
  phone: "<STRING>",  // мобильный номер
  email: "<STRING>",  // email  
}
```

**response**:

```js
{
  status: 100,
  response: {
    message: "Signed up successfully",
    token: <TOKEN>  // возможно сразу получаем токен, чтобы не авторизоваться
  }
}
```

**error response**:
 
```js
{
  status: 903,
  error: "Пользователь с таким логином уже существует"
}
```

```js
{
  status: 904,
  error: "Пользователь с таким телефоном уже существует"
}
```

#### 4. Получить информацию по строительным проектам

```POST /users/projects```

- *Authorization*: **required**
- *Roles*: **"админ" | "технадзор" | "подрядчик"** 

*Описание: метод служит для получения информации по доступным проектам, очередям проектам, объектам строительства для данного пользователя с ролями "технадзор" или "подрядчик", либо по всей инфраструктуре для пользователя с ролью "админ"*

**request**:

```js
{} // нет параметров, бэкенд распознает пользователя по токену
```

**response**:

```js
{
  status: 100,
  response: {
    projects: [<PROJECT>, <PROJECT>, ...],
  }
}
```

```js
<PROJECT> = {
  // идентификатор, наименование
  id, name, 
  // список очередей объекта
  stages: [<STAGE>, <STAGE>, ...] 
  ... // что-то еще
}

<STAGE> = {
  // идентификатор, наименование
  id, name, 
  // список объектов строительства для данной очереди
  objects: [<OBJECT>, <OBJECT>, ...] 
  // что-то еще
  ... 
}

<OBJECT> = {
  // идентификатор, наименование,
  id, name, 
  // ссылка на SVF-файл
  bucketUrl, 
  // что-то еще
  ... 
}
```


---
#### 5. Получить информацию по строительным работам для данного объекта строительства

```POST /users/object-works```

- *Authorization*: **required**
- *Roles*: **"админ" | "технадзор" | "подрядчик"** 

*Описание: метод служит для получения списка строительных работ по данному объекту строительства с перечнем элементов по каждой работе*

**request**:

```js
{
  objectId: <NUMBER>
}
```

**response**:

```js
{
  status: 100,
  response: {
    // какая-то инфа по объекту
    ...
    // список работ по этому объекту
    // подрядчик увидит только свои работы, технадзор и админ - полный список
    works: [<WORK>, <WORK>, ...],
  }
}
```

```js
<WORK> = {
  // идентификатор, наименование
  id, name, 
  // признак моделируемой работы
  relatedModel: <BOOL>,
  // если работа моделируемая, то нужно хранить оставшийся процент завершения работы
  percent: <NUMBER>,
  // если работа - немоделируема, то имеется список элементов модели
  elements: [<ELEMENT>, <ELEMENT>, ...] 
  // что-то еще
  ... 
}

<ELEMENT> = {
  // идентификатор,
  id: <NUMBER>, 
  // статус элемента модели в данной работе
  status: "строится" | "вкорзине" | "напроверке" | "частичнопринят" | "завершен",
  // оставшийся процент завершения элемента
  percent: <NUMBER>, 
  // что-то еще
  ... 
}

```

#### 6. Получить список доступных корзин для данного подрядчика
```POST /users/baskets```

- *Authorization*: **required**
- *Roles*: **"подрядчик"** 

*Описание: метод служит для получения списка корзин данного подрядчика*

**request**:

```js
{}
```

**response**:

```js
{
  status: 100,
  response: {
    baskets: [<BASKET>, <BASKET>, ...],
  }
}
```

```js
<BASKET> = {
  // идентификатор,
  id: <NUMBER>,
  // timestamps (срздание корзины, закрытие корзины подрядчиком, подтвержение корзины головным офисом)
  created_at, closed_at, confirmed_at: <TIMESTAMP>,
  // статус корзины 
  status: "активная" | "закрыта" | "подтверждена",
  // список работ в данной корзине (возможно ПО РАЗЛИЧНЫМ объектам строительства)
  works: [<BASKET_WORK>, <BASKET_WORK>, ...] 
  // что-то еще
  ... 
}
```

```js
<BASKET_WORK> = {
  // идентификатор объекта строительства 
  objectId: <NUMBER>, 
  // идентификатор работы для данного объекта
  workId: <NUMBER>,
  // статус элементов в корзине по данной работе
  status: "добавлена" | "напроверке" 
  // список идентификаторов элементов (используется в случае если работа моделируема)
  elements: [<NUMBER>, <NUMBER>, ...] 
}
```

#### 7. Добавить выбранные элементы для некоторой работы в корзину
```POST /users/add-to-basket```

- *Authorization*: **required**
- *Roles*: **"подрядчик"**

*Описание: метод служит для добавления некоторой работы в активную корзину, полностью, либо с некоторым списком элементов. Если активной корзины нет, она создается автоматически.*

**request**:

```js
{
  // идентификатор работы
  workId: <NUMBER>,
  // перечень элементов для добавления в корзину
  elements: [<NUMBER>, <NUMBER>, ...]
}
```

**response**:

```js
{
  status: 100,
  response: {
    message: "Added succesfully",
  }
}
```

#### 8. Удалить данной работу (вместе со всеми элементами) из корзины
```POST /users/delete-from-basket```

- *Authorization*: **required**
- *Roles*: **"подрядчик"** 

*Описание: метод служит для удаления некоторой работы (со всеми элементами) из активной корзины, если, конечно, данная работа еще не была отправлена на проверку в технадзор*

**request**:

```js
{
  workId: <NUMBER>,
}
```

**response**:

```js
{
  status: 100,
  response: {
    message: "Deleted succesfully",
  }
}
```

#### 9. Отправить элементы в корзине по данной работе на проверку в технадзор
```POST /users/send-for-checking```

- *Authorization*: **required**
- *Roles*: **"подрядчик"**

*Описание: метод служит для отправки некоторой работы в активной корзине (работа должна иметь статус "добавлена") на проверку в технадзор. Работа в корзине получает статус "напроверке"*

**request**:

```js
{
  workId: <NUMBER>,
}
```

**response**:

```js
{
  status: 100,
  response: {
    message: "Sent for checking succesfully",
  }
}
```

#### 10. Закрыть активную корзину
```POST /users/close-basket```

- *Authorization*: **required**
- *Roles*: **"подрядчик"** 

*Описание: метод служит для закрытия подрядчиком активной корзины. Все работы в корзине конечно должны быть уже отправлены на проверку. После успешного выполнения, добавлять элементы в эту корзину подрядчик уже не сможет. Будет автоматически создана новая активная корзина.*

**request**:

```js
{} // без параметров, активная корзина всегда одна
```

**response**:

```js
{
  status: 100,
  response: {
    message: "Closed succesfully",
  }
}
```

#### 11. Получить список карт (фильтров) для данного объекта строительства
```POST /users/object-maps```

- *Authorization*: **required**
- *Roles*: **"админ" | "технадзор" | "подрядчик"** 

*Описание: метод служит для получения списка карт (фильтров) для некоторого объекта строительства. Каждая карта представляет собой некоторый список элементов модели.*

*Пока вопрос открытый где, и каким образом, формируется список фильтров по модели объекта строительства.*

**request**:

```js
{
  objectId: <NUMBER> // идентификатор объекта строительства
} 
```

**response**:

```js
{
  status: 100,
  response: {
    maps: [<MAP>, <MAP>, ...]
  }
}
```

```js
<MAP> = {
  id, name,
  // список элементов модели по данной карте
  elements: [<NUMBER>, <NUMBER>, ...]
}
```

#### 12. Принять элементы по данной работе
```POST /users/accept-work```

- *Authorization*: **required**
- *Roles*: **"технадзор"** 

*Описание: метод служит для принятия (или неприянтия) некоторой работы (отправленной на проверку подрядчиком из своей активной корзины).*

*Если работа моделируема, то информациия о принятии находится в каждом элементе, если же нет, то принимается работа целиком*

**request**:

```js
{
  // идентификатор работы
  workId: <NUMBER>,

  // общая информация о принятии работы (если работа не связана с моделью)
  <WORK_ACCEPT_INFO>,

  // информация о принятии по элементам (в противном случае)
  elements: [<ELEMENT_ACCEPT_INFO>, <ELEMENT_ACCEPT_INFO>, ...]
} 
```

```js
<WORK_ACCEPT_INFO> = {
  result: "принято" | "частичнопринято" | "непринято"
  // процент принятия
  // в случае успешного принятия, равен исходному
  // в случае частичного принятия, меньше исходного
  // в случае отказа, равен 0 
  acceptPercent: <NUMBER>
}

<ELEMENT_ACCEPT_INFO> = {
  // идентификатор элемента
  id: <NUMBER>,
  result: "принято" | "частичнопринято" | "непринято"
  // процент принятия
  // в случае успешного принятия, равен исходному проценту по данному элементу
  // в случае частичного принятия, меньше исходного
  // в случае отказа, равен 0 
  acceptPercent: <NUMBER>
}
```

**response**:

```js
{
  status: 100,
  response: {
    message: "done"
  }
}
```


